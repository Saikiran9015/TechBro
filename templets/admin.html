{% extends "base.html" %}

{% block title %}Admin Dashboard | KropKart{% endblock %}

{% block content %}
<div class="animate-fade">
    <div class="hero-gradient" style="background: linear-gradient(135deg, #1e3a8a, #1e40af);">
        <h1 style="color: white; margin-bottom: 1rem;"><i class="fas fa-shield-alt"></i> Admin Control Center</h1>
        <p style="opacity: 0.9; font-size: 1.1rem; max-width: 600px; margin: 0 auto;">System-wide analytics,
            comprehensive transaction logs, and platform health monitoring.</p>
    </div>

    <!-- Stats Grid -->
    <div class="grid-cols-auto"
        style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 3rem;">
        <div class="card" style="text-align: center; border-left: 5px solid var(--primary);">
            <h3 class="text-muted" style="font-size: 1rem;">Total Revenue</h3>
            <div style="font-size: 2rem; font-weight: 800; color: var(--dark); margin: 0.5rem 0;">₹{{ total_revenue }}
            </div>
            <span class="badge" style="background: #dcfce7; color: var(--primary);">All Time</span>
        </div>
        <div class="card" style="text-align: center; border-left: 5px solid var(--secondary);">
            <h3 class="text-muted" style="font-size: 1rem;">Total Users</h3>
            <div style="font-size: 2rem; font-weight: 800; color: var(--dark); margin: 0.5rem 0;">{{ total_users }}
            </div>
            <span class="badge" style="background: #fef9c3; color: #b45309;">Registered</span>
        </div>
        <div class="card" style="text-align: center; border-left: 5px solid #3b82f6;">
            <h3 class="text-muted" style="font-size: 1rem;">Active Listings</h3>
            <div style="font-size: 2rem; font-weight: 800; color: var(--dark); margin: 0.5rem 0;">{{ total_products }}
            </div>
            <span class="badge" style="background: #dbeafe; color: #1e3a8a;">Live Products</span>
        </div>
        <div class="card" style="text-align: center; border-left: 5px solid #a855f7;">
            <h3 class="text-muted" style="font-size: 1rem;">Transactions</h3>
            <div style="font-size: 2rem; font-weight: 800; color: var(--dark); margin: 0.5rem 0;">{{ total_orders }}
            </div>
            <span class="badge" style="background: #f3e8ff; color: #6b21a8;">Completed</span>
        </div>
    </div>

    <!-- Transaction History -->
    <div class="card mb-4">
        <div class="flex-between mb-4">
            <h2><i class="fas fa-history text-primary"></i> Recent Transactions</h2>
            <button class="btn btn-secondary" onclick="window.print()"><i class="fas fa-download"></i> Export
                Report</button>
        </div>

        <div style="overflow-x: auto;">
            <table style="width: 100%; border-collapse: collapse;">
                <thead>
                    <tr style="background: var(--gray-100); text-align: left;">
                        <th style="padding: 1rem; border-radius: 8px 0 0 8px;">Date</th>
                        <th style="padding: 1rem;">Customer</th>
                        <th style="padding: 1rem;">Product</th>
                        <th style="padding: 1rem;">Qty (kg)</th>
                        <th style="padding: 1rem;">Amount</th>
                        <th style="padding: 1rem;">Method</th>
                        <th style="padding: 1rem;">Shipment ID</th>
                        <th style="padding: 1rem; border-radius: 0 8px 8px 0;">Status</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in recent_orders %}
                    <tr style="border-bottom: 1px solid var(--gray-100);">
                        <td style="padding: 1rem; color: var(--gray-600);">{{ order.date.strftime('%Y-%m-%d %H:%M') }}
                        </td>
                        <td style="padding: 1rem; font-weight: 600;">{{ order.user }}</td>
                        <td style="padding: 1rem;">{{ order.product_name or 'Product Lot' }}</td>
                        <td style="padding: 1rem; font-weight: 700;">{{ order.quantity or 1 }} kg</td>
                        <td style="padding: 1rem; color: var(--primary); font-weight: bold;">₹{{ order.amount }}</td>
                        <td style="padding: 1rem;">
                            <span class="badge" style="background: #f1f5f9; color: #475569; font-size: 0.75rem;">
                                <i class="fas fa-credit-card"></i> {{ order.payment_method or 'Razorpay' }}
                            </span>
                        </td>
                        <td style="padding: 1rem; font-family: monospace; font-size: 0.85rem;">
                            {{ order.shipment_id if order.shipment_id else 'Manual Delivery' }}
                        </td>
                        <td style="padding: 1rem;">
                            <span class="badge" style="background: #dcfce7; color: var(--primary);">{{
                                order.status|upper }}</span>
                        </td>
                    </tr>
                    {% else %}
                    <tr>
                        <td colspan="5" style="padding: 2rem; text-align: center; color: var(--gray-400);">No
                            transactions found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- User Breakdown & Product Analytics -->
    <div class="grid-cols-auto" style="grid-template-columns: 1fr 1fr; gap: 2rem;">
        <div class="card">
            <h3 class="mb-4"><i class="fas fa-users text-secondary"></i> User Distribution</h3>
            <div style="display: flex; flex-direction: column; gap: 1rem;">
                {% for role, count in user_counts.items() %}
                <div class="flex-between">
                    <span style="font-weight: 500; text-transform: capitalize;">{{ role }}s</span>
                    <span class="badge">{{ count }}</span>
                </div>
                <div style="background: var(--gray-100); height: 8px; border-radius: 4px; overflow: hidden;">
                    <div
                        style="background: var(--primary); width: {{ (count / total_users * 100) if total_users > 0 else 0 }}%; height: 100%;">
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>

        <div class="card">
            <h3 class="mb-4"><i class="fas fa-chart-line text-primary"></i> System Health</h3>
            <ul style="list-style: none; padding: 0;">
                <li
                    style="padding: 0.8rem 0; border-bottom: 1px solid var(--gray-100); display: flex; justify-content: space-between;">
                    <span><i class="fas fa-server text-muted"></i> Server Status</span>
                    <span class="text-primary font-bold">Operational</span>
                </li>
                <li
                    style="padding: 0.8rem 0; border-bottom: 1px solid var(--gray-100); display: flex; justify-content: space-between;">
                    <span><i class="fas fa-database text-muted"></i> Database Connection</span>
                    <span class="text-primary font-bold">Connected</span>
                </li>
                <li style="padding: 0.8rem 0; display: flex; justify-content: space-between;">
                    <span><i class="fas fa-robot text-muted"></i> AI Models</span>
                    <span class="text-primary font-bold">Active</span>
                </li>
            </ul>
        </div>
    </div>
</div>
{% endblock %}